version: '3.8'

services:
  hesk-api:
    build: .
    container_name: hesk-api
    ports:
      - "3000:3000"
    environment:
      # Configuration du serveur
      - PORT=3000
      - NODE_ENV=production

      # JWT Secret (⚠️ CHANGEZ EN PRODUCTION via Portainer!)
      # Générez avec: openssl rand -hex 32
      - JWT_SECRET=hesk-api-secret-key-change-in-production-2024

      # Identifiants admin par défaut (⚠️ CHANGEZ EN PRODUCTION via Portainer!)
      - ADMIN_USERNAME=admin
      - ADMIN_PASSWORD=admin123

      # Clé de chiffrement (⚠️ CHANGEZ EN PRODUCTION via Portainer!)
      # Générez avec: openssl rand -hex 32
      - ENCRYPTION_KEY=hesk-encryption-key-change-in-production-2024

      # Base de données
      - DB_PATH=/app/data/database.sqlite

      # Rate Limiting
      - RATE_LIMIT_WINDOW_MS=900000
      - RATE_LIMIT_MAX_REQUESTS=100

    volumes:
      # Persister la base de données
      - hesk-data:/app/data

    restart: unless-stopped

    healthcheck:
      test: ["CMD", "node", "-e", "require('http').get('http://localhost:3000/health', (r) => process.exit(r.statusCode === 200 ? 0 : 1))"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

volumes:
  hesk-data:
    driver: local
